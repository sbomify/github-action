---
name: Integration Tests

on:  # yamllint disable-line rule:truthy
  push: null

jobs:
  build:
    name: Integration Tests
    runs-on: ubuntu-latest

    steps:
      - name: Code Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Install Poetry and dependencies
      - name: Install Poetry
        run: |
          curl -sSL https://install.python-poetry.org | python3 -
          poetry install

      # Run tests directly with Poetry
      - name: Run tests
        env:
          TOKEN: placeholder
          COMPONENT_ID: placeholder
          UPLOAD: false
          PYTHONPATH: ${{ github.workspace }}
        run: poetry run python tests/test_entrypoint.py

      - name: Run enrichment test
        run: |
          docker run --rm \
            -v $(pwd):/github/workspace \
            -w /github/workspace \
            -e TOKEN=placeholder \
            -e COMPONENT_ID=placeholder \
            -e UPLOAD=false \
            -e SBOM_FILE="tests/test-data/syft.cdx.json" \
            -e ENRICH=true \
            gha
